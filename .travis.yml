os: linux

language: node_js

node_js:
    - 12.14.1

addons:
    apt:
        packages:
            - jq
            - python3-pip
            - python3-setuptools

env:
    # The AWS JS SDK only respects AWS_REGION, not AWS_DEFAULT_REGION- https://github.com/aws/aws-sdk-js/issues/2929
    - AWS_DEFAULT_REGION=us-east-1 AWS_REGION="${AWS_DEFAULT_REGION}"

install:
    - pip3 install awscli --upgrade --user
    - npm install

script:
    - npm run build-and-test

deploy:
    skip_cleanup: true
    provider: script
    script: npm run release
    on:
        branch: master
